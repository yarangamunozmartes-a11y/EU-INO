<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiMarket Per√∫ - Marketplace Local</title>
    
    <!-- META TAGS PARA PWA -->
    <meta name="theme-color" content="#4f46e5">
    <meta name="description" content="Compra y vende productos en tu zona">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="MiMarket">
    
    <!-- ICONOS Y MANIFEST -->
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="./icon-192x192.png">
    
    <!-- ESTILOS -->
    <link rel="stylesheet" href="style.css">
    
    <!-- SUPABASE -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>

    <!-- ========== SPLASH SCREEN ========== -->
    <section id="splash">
        <div class="splash-content">
            <h1>MiMarket</h1>
            <p>Conectando compradores y vendedores locales</p>
        </div>
    </section>

    <!-- ========== APP PRINCIPAL ========== -->
    <main id="app" style="display: none;">
        
        <!-- HEADER -->
        <header class="top-bar">
            <h1 class="logo">MiMarket</h1>
            <div class="acciones">
                <button id="btn-comprar" class="btn-activo">Comprar</button>
                <button id="btn-vender">Vender</button>
                <button id="btn-admin" style="display:none;">Admin</button>
            </div>
        </header>

        <!-- ========== SECCIONES ========== -->
        
        <!-- B√öSQUEDA -->
        <section id="busqueda" class="seccion-activa">
            <div class="buscador-header">
                <h2>¬øQu√© est√°s buscando?</h2>
                <p class="subtitulo">Encuentra productos cerca de ti</p>
            </div>
            <form id="form-busqueda">
                <div class="input-group">
                    <input type="text" id="buscar-producto" placeholder="Ej: Bicicleta, Mueble, Ropa..." required>
                    <div class="select-group">
                        <select id="provincia" required>
                            <option value="">Provincia</option>
                            <option value="Lima">Lima</option>
                            <option value="Arequipa">Arequipa</option>
                            <option value="Cusco">Cusco</option>
                            <option value="Trujillo">Trujillo</option>
                            <option value="Piura">Piura</option>
                            <option value="Chiclayo">Chiclayo</option>
                        </select>
                        <select id="distrito" required>
                            <option value="">Distrito</option>
                            <option value="Miraflores">Miraflores</option>
                            <option value="San Isidro">San Isidro</option>
                            <option value="Surco">Surco</option>
                            <option value "La Molina">La Molina</option>
                            <option value="San Borja">San Borja</option>
                            <option value="Otros">Otros</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn-buscar">üîç Buscar Productos</button>
            </form>
        </section>

        <!-- RESULTADOS -->
        <section id="resultados">
            <div id="lista-resultados" class="grid-productos">
                <!-- Los productos se cargar√°n aqu√≠ con JavaScript -->
            </div>
            <p id="mensaje-vacio" class="mensaje-vacio">Busca productos para ver resultados</p>
        </section>

        <!-- VIDEO TUTORIAL (se muestra antes del registro) -->
        <section id="video-tutorial" style="display: none;">
            <h2>¬øC√≥mo funciona MiMarket?</h2>
            <div class="video-container">
                <div class="video-placeholder">
                    üé• Video Tutorial
                    <p style="font-size: 14px; margin-top: 10px;">Reg√≠strate para comenzar a vender</p>
                </div>
            </div>
            <div class="acciones-video">
                <button id="btn-saltar-video" class="btn-secundario">Saltar tutorial</button>
                <button id="btn-continuar-video" class="btn-buscar">Ver video completo</button>
            </div>
        </section>

        <!-- REGISTRO VENDEDOR -->
        <section id="registro-vendedor" style="display: none;">
            <h2>Reg√≠strate como Vendedor</h2>
            <p class="subtitulo">Comienza a vender en 2 minutos</p>
            
            <form id="form-vendedor">
                <div class="form-group">
                    <input type="text" id="nombre" placeholder="Nombre completo *" required>
                </div>
                
                <div class="form-group">
                    <input type="email" id="email" placeholder="Correo electr√≥nico *" required>
                </div>
                
                <div class="form-group">
                    <input type="tel" id="telefono" placeholder="WhatsApp (ej: 987654321) *" 
                           pattern="[0-9]{9}" 
                           title="Ingresa 9 d√≠gitos sin espacios" required>
                    <small class="input-hint">Sin c√≥digo de pa√≠s (9 d√≠gitos)</small>
                </div>
                
                <div class="select-group">
                    <div class="form-group">
                        <select id="provincia-vendedor" required>
                            <option value="">Selecciona provincia *</option>
                            <option value="Lima">Lima</option>
                            <option value="Arequipa">Arequipa</option>
                            <option value="Cusco">Cusco</option>
                            <option value="Trujillo">Trujillo</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <select id="distrito-vendedor" required>
                            <option value="">Selecciona distrito *</option>
                            <option value="Miraflores">Miraflores</option>
                            <option value="San Isidro">San Isidro</option>
                            <option value="Surco">Surco</option>
                            <option value="La Molina">La Molina</option>
                            <option value="Otros">Otros</option>
                        </select>
                    </div>
                </div>
                
                <div class="terminos">
                    <input type="checkbox" id="acepto-terminos" required>
                    <label for="acepto-terminos">
                        Acepto los <a href="#" onclick="mostrarTerminos()">t√©rminos y condiciones</a>
                    </label>
                </div>
                
                <button type="submit" class="btn-registro">Crear Cuenta Gratis</button>
                <p class="info-registro">* Obtienes 3 publicaciones gratuitas al registrarte</p>
            </form>
        </section>

        <!-- PERFIL VENDEDOR -->
        <section id="perfil-vendedor" style="display: none;">
            <div class="perfil-header">
                <div class="perfil-info">
                    <h2 id="perfil-nombre">Cargando...</h2>
                    <p id="perfil-localidad"></p>
                    <div class="estado-cuenta">
                        <p>üìä <strong>Cr√©ditos disponibles:</strong> 
                           <span id="contador-publicaciones" class="creditos-numero">0</span>
                        </p>
                        <small>Cada publicaci√≥n usa 1 cr√©dito</small>
                    </div>
                </div>
            </div>
            
            <div class="perfil-acciones">
                <button id="btn-nuevo-producto" class="btn-nuevo">‚ûï Publicar Nuevo Producto</button>
                <button id="btn-cerrar-sesion" class="btn-secundario">üîì Cambiar Cuenta</button>
            </div>
            
            <!-- FORMULARIO PARA NUEVO PRODUCTO -->
            <div id="formulario-producto" style="display: none;">
                <h3>Publicar Nuevo Producto</h3>
                <form id="form-producto">
                    <div class="form-group">
                        <input type="text" id="prod-nombre" placeholder="Nombre del producto *" required>
                    </div>
                    
                    <div class="form-group">
                        <input type="number" id="prod-precio" placeholder="Precio en Soles *" min="1" required>
                    </div>
                    
                    <div class="form-group">
                        <textarea id="prod-descripcion" placeholder="Descripci√≥n del producto..." rows="4"></textarea>
                    </div>
                    
                    <!-- SUBIR FOTOS -->
                    <div class="form-group">
                        <div class="upload-area" id="upload-area">
                            <div class="upload-placeholder">
                                <p>üì∑ <strong>Subir Fotos</strong></p>
                                <p class="upload-info">Arrastra o haz clic para subir im√°genes</p>
                                <p class="upload-hint">M√°ximo 2 fotos ‚Ä¢ Formatos: JPG, PNG</p>
                            </div>
                            <input type="file" id="fotos-producto" accept="image/*" multiple style="display:none">
                        </div>
                        <div id="preview-fotos" class="preview-fotos"></div>
                    </div>
                    
                    <div class="form-acciones">
                        <button type="submit" class="btn-publicar">üì§ Publicar Producto</button>
                        <button type="button" id="btn-cancelar" class="btn-cancelar">Cancelar</button>
                    </div>
                </form>
            </div>
            
            <!-- LISTA DE PRODUCTOS DEL VENDEDOR -->
            <div class="mis-productos">
                <h3>Mis Productos Publicados</h3>
                <div id="lista-productos" class="grid-productos">
                    <!-- Productos del vendedor se cargan aqu√≠ -->
                </div>
                <p id="mensaje-sin-productos" class="mensaje-vacio" style="display:none;">
                    A√∫n no tienes productos publicados
                </p>
            </div>
        </section>

        <!-- PANEL ADMIN (se crea din√°micamente) -->
        <!-- Se crear√° con JavaScript cuando sea necesario -->

    </main>

    <!-- ========== MODALES ========== -->
    
    <!-- MODAL CONTACTO PRODUCTO -->
    <div id="modal-contacto" class="modal" style="display:none">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            
            <!-- FOTOS DEL PRODUCTO -->
            <div id="modal-fotos" class="modal-fotos"></div>
            
            <!-- INFO PRODUCTO -->
            <h3 id="modal-producto-nombre"></h3>
            <p class="modal-precio" id="modal-producto-precio"></p>
            <p id="modal-producto-descripcion" class="modal-descripcion"></p>
            
            <!-- INFO VENDEDOR -->
            <div class="modal-info-vendedor">
                <p><strong>Vendedor:</strong> <span id="modal-vendedor-nombre"></span></p>
                <p><strong>Ubicaci√≥n:</strong> <span id="modal-vendedor-ubicacion"></span></p>
            </div>
            
            <!-- BOTONES CONTACTO -->
            <div class="modal-botones">
                <button id="btn-llamar" class="btn-llamar">üìû Llamar</button>
                <button id="btn-whatsapp" class="btn-whatsapp">üí¨ WhatsApp</button>
                <button id="btn-cerrar-modal" class="btn-secundario">Cerrar</button>
            </div>
            
            <!-- CONSEJO DE SEGURIDAD -->
            <div class="modal-consejo">
                <p>üîí <strong>Consejo de seguridad:</strong> 
                Encu√©ntrate en lugares p√∫blicos para realizar la transacci√≥n</p>
            </div>
        </div>
    </div>

    <!-- MODAL T√âRMINOS Y CONDICIONES -->
    <div id="modal-terminos" class="modal" style="display:none">
        <div class="modal-content">
            <span class="close-modal" onclick="cerrarTerminos()">&times;</span>
            <h2>T√©rminos y Condiciones</h2>
            <div class="terminos-contenido">
                <p><strong>√öltima actualizaci√≥n:</strong> Enero 2024</p>
                
                <h3>1. Uso del Servicio</h3>
                <p>MiMarket Per√∫ es una plataforma que conecta compradores y vendedores locales...</p>
                
                <h3>2. Responsabilidades del Vendedor</h3>
                <p>El vendedor es responsable de la veracidad de la informaci√≥n publicada...</p>
                
                <h3>3. Conducta del Usuario</h3>
                <p>Los usuarios deben comportarse de manera respetuosa y √©tica...</p>
                
                <h3>4. Limitaci√≥n de Responsabilidad</h3>
                <p>MiMarket act√∫a √∫nicamente como intermediario y no se responsabiliza...</p>
                
                <button onclick="cerrarTerminos()" class="btn-buscar">Entendido</button>
            </div>
        </div>
    </div>

    <!-- PROMPT INSTALACI√ìN PWA -->
    <div id="installPrompt" class="hidden">
        <div class="install-content">
            <p>üì≤ <strong>Instala MiMarket</strong></p>
            <p>Para mejor experiencia, instala la app en tu dispositivo</p>
            <div class="install-botones">
                <button id="installButton" class="install-btn">Instalar Ahora</button>
                <button id="cancelInstall" class="install-btn secondary">Despu√©s</button>
            </div>
        </div>
    </div>

    <!-- ========== SCRIPTS ========== -->
    <!-- ORDEN IMPORTANTE: 1. install.js, 2. app.js -->
    <script src="install.js"></script>
    <script src="app.js"></script>
    
    <!-- SCRIPT INLINE PEQUE√ëO PARA FUNCIONES B√ÅSICAS -->
    <script>
        // Funciones b√°sicas que necesitan estar disponibles inmediatamente
        function mostrarTerminos() {
            document.getElementById('modal-terminos').style.display = 'block';
            return false;
        }
        
        function cerrarTerminos() {
            document.getElementById('modal-terminos').style.display = 'none';
        }
        
        // Cerrar modales al hacer clic fuera
        window.onclick = function(event) {
            const modales = document.querySelectorAll('.modal');
            modales.forEach(modal => {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            });
        }
    </script>

</body>
</html>

